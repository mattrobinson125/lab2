---
title: "Lab 2: Use of Deadly Force by Police"
author: "Matt Robinson & Vincent Lee"
date: "9/26/2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

###Introduction
For this lab, we took a look at the use of deadly force by police officers in the United States. This analysis is based on the work of Julia Silge of "data science ish". The original article is here <https://www.r-bloggers.com/fatal-police-shootings-across-the-u-s/>. The data is courtesy of the Washington Post, who has been curating a publicly available database of fatal police shooting data since January 1, 2015. 

The following lines of code import necessary libraries to execute this code:

```{r message=FALSE}
library(flexdashboard)
library(lubridate)
library(dplyr)
library(ggplot2)
library(ggstance)
library(ggalt)
```

We then import the data set obtained from the Washington Post police shootings database. Then, we clean up the code by changing dates, genders, races, and manners of death to an understandable format.

```{r}
fatalshootings <- read.csv("./fatal-police-shootings-data.csv", stringsAsFactors = FALSE)
fatalshootings$date <- ymd(fatalshootings$date)
fatalshootings[,c(4:5,7:8,9:14)] <- lapply(fatalshootings[,c(4:5,7:8,9:14)], as.factor)
levels(fatalshootings$gender) <- c("Female", "Male")
levels(fatalshootings$race) <- c("Unknown", "Asian", "Black", "Hispanic", "Unknown", "Other", "White")
fatalshootings$race <- factor(fatalshootings$race, levels(fatalshootings$race)[c(5,2,1,4,3,6)])
levels(fatalshootings$flee) <- c("Unknown", "Car", "Foot", "Not fleeing", "Other")
fatalshootings$flee <- factor(fatalshootings$flee, levels(fatalshootings$flee)[c(1,5,3,2,4)])
levels(fatalshootings$manner_of_death) <- c("Beaten", "Shot", "Shot/Tasered")
fatalshootings$manner_of_death <- factor(fatalshootings$manner_of_death, levels(fatalshootings$manner_of_death)[c(1,3,2)])
```

Once we have our clean data, we are ready to start creating interesting visualizations using ggplot.

###Demographic Analysis

#####Deaths by Race/Ethnicity
```{r}
ggplot(data = fatalshootings, aes(y = race)) + 
        geom_barh(aes(fill = ..count..)) +
        theme_minimal(base_size = 13) +
        theme(legend.position = "none") +
        scale_x_continuous(expand=c(0,0)) +
        scale_fill_gradient(low = "royalblue3", high = "navyblue") +
        labs(y = NULL, x = "Number of deaths")
```

#####Deaths by Gender
```{r}
ggplot(data = fatalshootings, aes(y = gender)) + 
        geom_barh(aes(fill = ..count..)) +
        theme_minimal(base_size = 13) +
        theme(legend.position = "none") +
        scale_x_continuous(expand=c(0,0)) +
        scale_fill_gradient(low = "royalblue3", high = "navyblue") +
        labs(y = NULL, x = "Number of deaths")
```

##### Deaths by Age
```{r warning=FALSE}
ggplot(data = fatalshootings, aes(x = age)) + 
        geom_histogram(aes(fill = ..count..), bins = 20) +
        theme_minimal(base_size = 13) +
        theme(legend.position = "none") +
        scale_x_continuous(expand=c(0,0)) +
        scale_fill_gradient(low = "royalblue3", high = "navyblue") +
        labs(x = "Age at death", y = "Number of deaths")
```

#####Deaths based on mental illness
```{r}
ggplot(data = fatalshootings, aes(y = signs_of_mental_illness)) + 
        geom_barh(aes(fill = ..count..)) +
        theme_minimal(base_size = 13) +
        theme(legend.position = "none") +
        scale_x_continuous(expand=c(0,0)) +
        scale_fill_gradient(low = "royalblue3", high = "navyblue") +
        labs(y = NULL, x = "Number of deaths")
```

###Date of Shootings

#####Overall
```{r}
ggplot(data = fatalshootings, aes(x = date)) + 
        geom_histogram(aes(fill = ..count..), bins = 25) +
        theme_minimal() +
        theme(legend.position = "none") +
        scale_fill_gradient(low = "royalblue3", high = "navyblue") +
        labs(x = NULL, y = "Number of deaths")
```

#####Deaths by Month
```{r}
ggplot(data = fatalshootings, aes(x = month(date, label = TRUE))) + 
        geom_bar(aes(fill = ..count..)) +
        theme_minimal() +
        theme(legend.position = "none") +
        scale_y_continuous(expand=c(0,0)) +
        scale_fill_gradient(low = "royalblue3", high = "navyblue") +
        labs(x = NULL, y = "Number of deaths")
```

#####Deaths by Day of Week
```{r}
ggplot(data = fatalshootings, aes(x = wday(date, label = TRUE))) + 
        geom_bar(aes(fill = ..count..)) +
        theme_minimal() +
        theme(legend.position = "none") +
        scale_y_continuous(expand=c(0,0)) +
        scale_fill_gradient(low = "royalblue3", high = "navyblue") +
        labs(x = NULL, y = "Number of deaths")
```

###Location Breakdown

#####Deaths by State
```{r message=FALSE}
stateinfo <- fatalshootings %>% group_by(state) %>% summarise(n = n()) %>% 
        arrange(desc(n)) %>% top_n(15) %>% 
        mutate(state = factor(state, levels = rev(unique(state))))
ggplot(stateinfo, aes(x = n, y = state)) +
        geom_barh(stat="identity", aes(fill = n)) +
        geom_text(aes(x = 17, y = state, label=as.character(state)), color="white", size=4) +
        labs(y = NULL, x = "Number of deaths") +
        scale_fill_gradient(low = "royalblue3", high = "navyblue") +
        theme_minimal(base_size = 13) +
        theme(axis.text.y=element_blank()) +
        theme(legend.position = "none") +
        scale_x_continuous(expand=c(0,0))
```

###Circumstances of Death

#####Was the victim armed?
```{r message=FALSE}
armedinfo <- fatalshootings %>% group_by(armed) %>% summarise(n = n()) %>% 
        arrange(desc(n)) %>% top_n(10) %>% 
        mutate(armed = factor(armed, levels = rev(unique(armed))))

ggplot(data = armedinfo, aes(x = n, y = armed)) + 
        geom_barh(stat="identity", aes(fill = n)) +
        theme_minimal(base_size = 13) +
        theme(legend.position = "none") +
        scale_x_continuous(expand=c(0,0)) +
        scale_fill_gradient(low = "royalblue3", high = "navyblue") +
        labs(y = NULL, x = "Number of deaths")
```


#####Was the officer wearing a body camera?
```{r}
ggplot(data = fatalshootings, aes(y = body_camera)) + 
        geom_barh(aes(fill = ..count..)) +
        theme_minimal(base_size = 13) +
        theme(legend.position = "none") +
        scale_x_continuous(expand=c(0,0)) +
        scale_fill_gradient(low = "royalblue3", high = "navyblue") +
        labs(y = NULL, x = "Number of deaths")
```


#####Was the victim fleeing?
```{r}
ggplot(data = fatalshootings, aes(y = flee)) + 
        geom_barh(aes(fill = ..count..)) +
        theme_minimal(base_size = 13) +
        theme(legend.position = "none") +
        scale_x_continuous(expand=c(0,0)) +
        scale_fill_gradient(low = "royalblue3", high = "navyblue") +
        labs(y = NULL, x = "Number of deaths")
```

#####How was the person killed?
```{r}
ggplot(data = fatalshootings, aes(y = manner_of_death)) + 
        geom_barh(aes(fill = ..count..)) +
        theme_minimal(base_size = 13) +
        theme(legend.position = "none") +
        scale_x_continuous(expand=c(0,0)) +
        scale_fill_gradient(low = "royalblue3", high = "navyblue") +
        labs(y = NULL, x = "Number of deaths")
```

